<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RaspaCash - Sistema de Raspadinha Online</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Meta Tags para SEO -->
    <meta name="description" content="RaspaCash - O melhor sistema de raspadinha online do Brasil! Ganhe pr√™mios de at√© R$ 2.000 raspando cartelas digitais.">
    <meta name="keywords" content="raspadinha, loteria, pr√™mios, jogos, Brasil, dinheiro, PIX">
    <meta property="og:title" content="RaspaCash - Sistema de Raspadinha Online">
    <meta property="og:description" content="Ganhe pr√™mios de at√© R$ 2.000 raspando cartelas digitais!">
    <meta property="og:url" content="https://raspacashbr.online">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé∞</text></svg>">
    
    <style>
        /* Anima√ß√µes customizadas */
        @keyframes pulse-gold {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            }
            50% { 
                box-shadow: 0 0 40px rgba(251, 191, 36, 0.8);
            }
        }
        
        .animate-pulse-gold {
            animation: pulse-gold 2s infinite;
        }
        
        @keyframes shine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        
        .animate-shine {
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            background-size: 200% 200%;
            animation: shine 2s infinite;
        }
        
        /* Esconder scrollbar mas manter funcionalidade */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 text-white min-h-screen min-h-[100dvh] overflow-x-hidden">
    <!-- Container Principal -->
    <div id="app">
        <!-- Tela de Login -->
        <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-gradient-to-br from-purple-900/90 via-blue-900/90 to-cyan-900/90 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-cyan-400/30 shadow-2xl">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent mb-2">
                        üé∞ RaspaCash
                    </h1>
                    <p class="text-cyan-300">Entre para come√ßar a raspar e ganhar!</p>
                    <p class="text-sm text-gray-400 mt-2">Pr√™mios de at√© R$ 2.000!</p>
                </div>
                
                <div class="space-y-4">
                    <input
                        type="text"
                        id="userName"
                        placeholder="Seu nome completo"
                        class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400"
                        required
                    />
                    <input
                        type="email"
                        id="userEmail"
                        placeholder="Seu e-mail"
                        class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400"
                        required
                    />
                    <button
                        onclick="handleLogin()"
                        id="loginButton"
                        class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-600 disabled:to-gray-700 text-white font-bold py-3 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:hover:scale-100"
                    >
                        üé≤ Entrar e Jogar
                    </button>
                </div>
                
                <div class="mt-6 text-center text-sm text-gray-400">
                    <p>Ao entrar, voc√™ concorda com nossos termos de uso</p>
                </div>
            </div>
        </div>

        <!-- Tela Principal do Jogo -->
        <div id="gameScreen" class="hidden">
            <!-- Header -->
            <header class="bg-gradient-to-r from-purple-900/80 via-blue-900/80 to-cyan-900/80 backdrop-blur-lg border-b border-cyan-400/30 shadow-lg">
                <div class="container mx-auto px-4 py-4">
                    <!-- Logo e Saldo -->
                    <div class="flex justify-between items-center mb-4 sm:mb-0">
                        <h1 class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                            üé∞ RaspaCash
                        </h1>
                        
                        <div class="text-right">
                            <div class="text-xs sm:text-sm text-cyan-300">Saldo</div>
                            <div class="text-lg sm:text-xl font-bold text-green-400" id="balance">R$ 0,00</div>
                        </div>
                    </div>
                    
                    <!-- Bot√µes - Layout responsivo -->
                    <div class="grid grid-cols-3 gap-2 sm:flex sm:justify-end sm:space-x-4">
                        <button
                            onclick="showModal('depositModal')"
                            class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-2 px-2 sm:px-4 rounded-lg transition-all duration-300 text-xs sm:text-sm"
                        >
                            <span class="hidden sm:inline">üí∞ Depositar</span>
                            <span class="sm:hidden">üí∞</span>
                        </button>
                        
                        <button
                            onclick="showModal('withdrawModal')"
                            class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-2 px-2 sm:px-4 rounded-lg transition-all duration-300 text-xs sm:text-sm"
                        >
                            <span class="hidden sm:inline">üí∏ Sacar</span>
                            <span class="sm:hidden">üí∏</span>
                        </button>
                        
                        <button
                            onclick="showModal('feedModal')"
                            class="bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-2 px-2 sm:px-4 rounded-lg transition-all duration-300 text-xs sm:text-sm"
                        >
                            <span class="hidden sm:inline">üèÜ Ganhos</span>
                            <span class="sm:hidden">üèÜ</span>
                        </button>
                        
                        <button
                            onclick="logout()"
                            class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-2 px-2 rounded-lg transition-all duration-300 text-xs sm:text-sm col-span-3 sm:col-span-1 mt-2 sm:mt-0"
                        >
                            üö™ Sair
                        </button>
                    </div>
                </div>
            </header>

            <main class="container mx-auto px-4 py-4 sm:py-8 min-h-[calc(100vh-120px)]">
                <!-- Sele√ß√£o de Planos -->
                <div id="planSelection">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-yellow-300 mb-2">Escolha seu Plano</h2>
                        <p class="text-cyan-300">Selecione o plano ideal para voc√™!</p>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-12" id="plansGrid">
                        <!-- Planos ser√£o inseridos aqui via JavaScript -->
                    </div>
                    
                    <!-- Pacotes Promocionais -->
                    <div class="bg-gradient-to-br from-orange-900/30 via-red-900/30 to-pink-900/30 backdrop-blur-lg rounded-xl p-6 border border-orange-400/30">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold text-orange-300 mb-2">üî• Pacotes Promocionais üî•</h3>
                            <p class="text-gray-300">Economize comprando em pacotes!</p>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4" id="promoPacks">
                            <!-- Pacotes promocionais ser√£o inseridos aqui -->
                        </div>
                    </div>
                </div>

                <!-- Tela do Jogo -->
                <div id="gameArea" class="hidden max-w-2xl mx-auto">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-yellow-300 mb-2" id="gameTitle">
                            Plano Selecionado
                        </h2>
                        <p class="text-cyan-300">Raspe para revelar os n√∫meros!</p>
                        
                        <button
                            onclick="backToPlans()"
                            class="mt-4 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300"
                        >
                            ‚Üê Voltar aos Planos
                        </button>
                    </div>

                    <!-- Cartela de Raspadinha -->
                    <div class="bg-gradient-to-br from-gray-800 via-gray-900 to-black rounded-xl p-6 mb-6 border-2 border-yellow-400/30 shadow-2xl">
                        <div class="relative">
                            <!-- N√∫meros da Cartela -->
                            <div class="grid grid-cols-5 gap-2 w-full max-w-sm mx-auto mb-4" id="numbersGrid">
                                <!-- N√∫meros ser√£o inseridos aqui -->
                            </div>

                            <!-- √Årea de Raspadinha Simplificada -->
                            <div id="scratchArea" class="relative w-full max-w-sm mx-auto h-48 rounded-lg cursor-pointer border-2 border-white/30 overflow-hidden">
                                <!-- Overlay de Cobertura -->
                                <div 
                                    id="scratchOverlay" 
                                    class="absolute inset-0 bg-gradient-to-br from-gray-300 via-gray-400 to-gray-500 flex items-center justify-center transition-opacity duration-500"
                                    style="background-image: radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px); background-size: 20px 20px;"
                                >
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-700 mb-2">ü™ô RASPE AQUI ü™ô</div>
                                        <div class="text-sm text-gray-600 animate-pulse">Clique 5 vezes para revelar</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Barra de Progresso -->
                            <div class="mt-4 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-cyan-300">√Årea raspada: <span id="scratchProgress">0.0%</span></span>
                                    <span class="text-yellow-300 font-bold animate-pulse">‚ö° Continue raspando! ‚ö°</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-3 mt-2 border border-yellow-400/30">
                                    <div 
                                        id="progressBar"
                                        class="bg-gradient-to-r from-green-400 via-yellow-400 to-orange-400 h-3 rounded-full transition-all duration-300 shadow-lg"
                                        style="width: 0%"
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resultado -->
                    <div id="gameResult" class="hidden bg-gradient-to-br from-purple-900/80 via-blue-900/80 to-cyan-900/80 backdrop-blur-lg rounded-xl p-6 mb-6 border border-cyan-400/30 shadow-2xl">
                        <div class="text-center mb-4">
                            <h3 class="text-xl font-bold text-yellow-300 mb-2">üéâ N√∫meros Revelados!</h3>
                            <div id="resultContent">
                                <!-- Resultado ser√° inserido aqui -->
                            </div>
                        </div>
                    </div>

                    <!-- Bot√£o Nova Cartela -->
                    <div id="newGameButton" class="hidden text-center mb-6">
                        <button
                            onclick="startNewGame()"
                            class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-200"
                        >
                            üé≤ Jogar Novamente
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Dep√≥sito -->
    <div id="depositModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 rounded-xl p-6 max-w-md w-full border border-cyan-400/30">
            <h3 class="text-xl font-bold text-yellow-300 mb-4">üí∞ Dep√≥sito via PIX</h3>
            
            <div class="space-y-4">
                <input
                    type="number"
                    id="depositAmount"
                    placeholder="Valor (m√≠nimo R$ 10)"
                    class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white"
                    min="10"
                />
                
                <div class="text-center">
                    <p class="text-cyan-300 mb-2">PIX Copia e Cola:</p>
                    <div class="bg-gray-800 p-3 rounded-lg font-mono text-sm text-green-400 break-all" id="pixCode">
                        00020126580014br.gov.bcb.pix01364adb8d4e-8b5c-4d5f-9e2f-1234567890ab5204000053039865802BR5925RASPACASH LTDA6009SAO PAULO62140510RPX106304ABCD
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button
                        onclick="confirmDeposit()"
                        class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-3 rounded-lg"
                    >
                        ‚úÖ Confirmar
                    </button>
                    <button
                        onclick="hideModal('depositModal')"
                        class="flex-1 bg-gray-600 text-white font-bold py-3 rounded-lg"
                    >
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Feed de Ganhos -->
    <div id="feedModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 rounded-xl p-6 max-w-md w-full border border-cyan-400/30">
            <h3 class="text-xl font-bold text-yellow-300 mb-4">üèÜ √öltimos Ganhos</h3>
            
            <div class="space-y-3 max-h-64 overflow-y-auto hide-scrollbar" id="feedContent">
                <!-- Feed ser√° inserido aqui -->
            </div>
            
            <button
                onclick="hideModal('feedModal')"
                class="w-full mt-4 bg-gray-600 text-white font-bold py-3 rounded-lg"
            >
                Fechar
            </button>
        </div>
    </div>

    <!-- Modal de Saque -->
    <div id="withdrawModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 rounded-xl p-6 max-w-md w-full border border-cyan-400/30">
            <h3 class="text-xl font-bold text-yellow-300 mb-4">üí∏ Saque via PIX</h3>
            
            <div class="space-y-4">
                <input
                    type="number"
                    id="withdrawAmount"
                    placeholder="Valor do saque"
                    class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white"
                />
                
                <input
                    type="text"
                    id="withdrawName"
                    placeholder="Nome completo"
                    class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white"
                />
                
                <select
                    id="pixKeyType"
                    class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white"
                >
                    <option value="cpf">CPF</option>
                    <option value="email">E-mail</option>
                    <option value="phone">Telefone</option>
                    <option value="random">Chave Aleat√≥ria</option>
                </select>
                
                <input
                    type="text"
                    id="pixKey"
                    placeholder="Chave PIX"
                    class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white"
                />
                
                <div class="flex space-x-3">
                    <button
                        onclick="confirmWithdraw()"
                        class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 rounded-lg"
                    >
                        üí∏ Sacar
                    </button>
                    <button
                        onclick="hideModal('withdrawModal')"
                        class="flex-1 bg-gray-600 text-white font-bold py-3 rounded-lg"
                    >
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado global da aplica√ß√£o
        let gameState = {
            isLoggedIn: false,
            user: { name: '', email: '' },
            balance: 0,
            selectedPlan: null,
            scratchCard: null,
            isScratching: false,
            isRevealed: false,
            scratchedArea: 0,
            prize: 0,
            loyaltySequences: {
                1: { spent: 0, games: 0 },
                2: { spent: 0, games: 0 },
                3: { spent: 0, games: 0 }
            },
            // Novo: controle de pacotes promocionais
            currentPromoPackage: null,
            promoCardsRemaining: [],
            currentPromoCard: 0
        };

        // Dados dos planos
        const plans = [
            {
                id: 1,
                name: "Plano Cl√°ssico",
                cost: 5,
                maxPrize: 500,
                color: "from-green-400 to-green-600",
                description: "Divers√£o garantida com pr√™mios de at√© R$ 500!"
            },
            {
                id: 2,
                name: "Plano Premium",
                cost: 10,
                maxPrize: 1000,
                color: "from-purple-400 to-purple-600",
                description: "Experi√™ncia premium com pr√™mios de at√© R$ 1.000!"
            },
            {
                id: 3,
                name: "Plano VIP",
                cost: 20,
                maxPrize: 2000,
                color: "from-red-400 to-red-600",
                description: "Exclusividade VIP com pr√™mios de at√© R$ 2.000!"
            }
        ];

        // Pacotes promocionais
        const promotionalPacks = [
            {
                id: 'promo-1',
                planId: 1,
                name: "Pacote Cl√°ssico",
                quantity: 5,
                originalPrice: 25,
                promoPrice: 15,
                discount: 40,
                color: "from-green-400 to-green-600"
            },
            {
                id: 'promo-2',
                planId: 2,
                name: "Pacote Premium",
                quantity: 5,
                originalPrice: 50,
                promoPrice: 40,
                discount: 20,
                color: "from-purple-400 to-purple-600"
            },
            {
                id: 'promo-3',
                planId: 3,
                name: "Pacote VIP",
                quantity: 5,
                originalPrice: 100,
                promoPrice: 80,
                discount: 20,
                color: "from-red-400 to-red-600"
            }
        ];

        // Listas para gerar feed din√¢mico de ganhos
        const firstNames = [
            "Maria", "Jo√£o", "Ana", "Pedro", "Carla", "Roberto", "Fernanda", "Carlos", 
            "Juliana", "Ricardo", "Patricia", "Marcos", "Luciana", "Rafael", "Claudia",
            "Daniel", "Mariana", "Gustavo", "Renata", "Bruno", "Gabriela", "Felipe",
            "Vanessa carme", "Andr√©", "Camila", "Rodrigo", "Beatriz", "Leonardo", "Isabela",
            "Thiago", "Amanda", "Vinicius", "Larissa", "Fabio", "Natalia", "Diego",
            "Caroline", "Eduardo", "Priscila", "Henrique", "Tatiane", "Leandro"
        ];
        
        const lastNames = [
            "Silva", "Santos", "Costa", "Lima", "Souza", "Oliveira", "Pereira", "Rodrigues",
            "Almeida", "Nascimento", "Ferreira", "Ara√∫jo", "Ribeiro", "Rocha", "Martins",
            "Carvalho", "Barbosa", "Gomes", "Dias", "Mendes", "Cardoso", "Moreira",
            "Fernandes", "Campos", "Vieira", "Castro", "Ramos", "Pinto", "Freitas",
            "Teixeira", "Correia", "Monteiro", "Neves", "Machado", "Cavalcante"
        ];
        
        function generateRandomWins() {
            const wins = [];
            const planNames = ["Cl√°ssico", "Premium", "VIP"];
            const maxPrizes = [500, 1000, 2000];
            
            for (let i = 0; i < 8; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const planIndex = Math.floor(Math.random() * planNames.length);
                const minPrize = [10, 20, 40][planIndex];
                const prize = Math.floor(Math.random() * (maxPrizes[planIndex] - minPrize + 1)) + minPrize;
                const timeAgo = Math.floor(Math.random() * 60) + 1;
                
                wins.push({
                    name: `${firstName} ${lastName}`,
                    prize: prize,
                    plan: planNames[planIndex],
                    time: `${timeAgo} min atr√°s`
                });
            }
            
            // Ordenar por tempo (mais recente primeiro)
            return wins.sort((a, b) => parseInt(a.time) - parseInt(b.time));
        }

        // Fun√ß√µes de utilidade - Sistema de Login Persistente
        function saveGameState() {
            // Salvar estado do usu√°rio baseado no email como chave √∫nica
            const userKey = `raspacash_user_${gameState.user.email}`;
            const userData = {
                name: gameState.user.name,
                email: gameState.user.email,
                balance: gameState.balance,
                loyaltySequences: gameState.loyaltySequences,
                lastLogin: new Date().toISOString()
            };
            localStorage.setItem(userKey, JSON.stringify(userData));
            localStorage.setItem('raspacash_last_user', gameState.user.email);
        }

        function loadGameState() {
            const lastUserEmail = localStorage.getItem('raspacash_last_user');
            if (lastUserEmail) {
                const userKey = `raspacash_user_${lastUserEmail}`;
                const saved = localStorage.getItem(userKey);
                if (saved) {
                    const userData = JSON.parse(saved);
                    gameState.user = { name: userData.name, email: userData.email };
                    gameState.balance = userData.balance || 0;
                    gameState.loyaltySequences = userData.loyaltySequences || {
                        1: { spent: 0, games: 0 },
                        2: { spent: 0, games: 0 },
                        3: { spent: 0, games: 0 }
                    };
                    gameState.isLoggedIn = true;
                    return true;
                }
            }
            return false;
        }

        function createUserAccount(name, email) {
            // Verificar se usu√°rio j√° existe
            const userKey = `raspacash_user_${email}`;
            const existingUser = localStorage.getItem(userKey);
            
            if (existingUser) {
                // Usu√°rio existe, carregar dados
                const userData = JSON.parse(existingUser);
                gameState.user = { name: userData.name, email: userData.email };
                gameState.balance = userData.balance || 0;
                gameState.loyaltySequences = userData.loyaltySequences || {
                    1: { spent: 0, games: 0 },
                    2: { spent: 0, games: 0 },
                    3: { spent: 0, games: 0 }
                };
                return true;
            } else {
                // Novo usu√°rio, criar conta
                gameState.user = { name, email };
                gameState.balance = 0;
                gameState.loyaltySequences = {
                    1: { spent: 0, games: 0 },
                    2: { spent: 0, games: 0 },
                    3: { spent: 0, games: 0 }
                };
                saveGameState();
                return false; // Indica que √© um novo usu√°rio
            }
        }

        function updateBalance() {
            document.getElementById('balance').textContent = `R$ ${gameState.balance.toFixed(2).replace('.', ',')}`;
        }

        // Algoritmo para determinar vit√≥ria
        function shouldWin(planId) {
            const loyalty = gameState.loyaltySequences[planId];
            const plan = plans.find(p => p.id === planId);
            const loyaltyThreshold = plan.cost * 10;
            
            if (loyalty.spent >= loyaltyThreshold) {
                const bonusGames = loyalty.games - (loyaltyThreshold / plan.cost);
                const winChance = Math.min(0.1 + (bonusGames * 0.02), 0.3);
                return Math.random() < winChance;
            }
            
            return false;
        }

        function calculatePrize(planId) {
            const plan = plans.find(p => p.id === planId);
            const minPrize = plan.cost * 2;
            const maxPrize = plan.maxPrize;
            return Math.floor(Math.random() * (maxPrize - minPrize + 1)) + minPrize;
        }

        function generateScratchCard(planId) {
            const numbers = [];
            
            // Definir ranges de n√∫meros baseado no plano
            let minNum = 1, maxNum = 10;
            if (planId === 'premium') {
                maxNum = 50;
            } else if (planId === 'vip') {
                maxNum = 100;
            }
            
            // Gerar 9 n√∫meros para o grid 3x3
            for (let i = 0; i < 9; i++) {
                const num = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                numbers.push(num);
            }
            
            // Verificar se jogador ganha (0.01% de chance)
            const willWin = Math.random() < 0.0001; // 0.01%
            
            if (willWin) {
                // For√ßar um triple match
                const winningNumber = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                
                // Substituir 3 posi√ß√µes aleat√≥rias com o n√∫mero ganhador
                const positions = [0, 1, 2, 3, 4, 5, 6, 7, 8];
                const shuffledPositions = positions.sort(() => 0.5 - Math.random());
                
                for (let i = 0; i < 3; i++) {
                    numbers[shuffledPositions[i]] = winningNumber;
                }
                
                return {
                    id: Date.now() + Math.random(),
                    planId,
                    numbers,
                    winningNumbers: [winningNumber, winningNumber, winningNumber],
                    willWin: true,
                    prize: winningNumber
                };
            }
            
            // Garantir que n√£o h√° triple match acidental
            const numberCounts = {};
            numbers.forEach(num => {
                numberCounts[num] = (numberCounts[num] || 0) + 1;
            });
            
            // Se houver 3 ou mais iguais acidentalmente, randomizar novamente
            for (let num in numberCounts) {
                if (numberCounts[num] >= 3) {
                    const positions = numbers.map((n, i) => n === parseInt(num) ? i : -1).filter(i => i !== -1);
                    for (let i = 2; i < positions.length; i++) {
                        let newNum;
                        do {
                            newNum = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                        } while (newNum === parseInt(num));
                        numbers[positions[i]] = newNum;
                    }
                }
            }
            
            return {
                id: Date.now() + Math.random(),
                planId,
                numbers,
                winningNumbers: [],
                willWin: false,
                prize: 0
            };
        }

        function generateMultipleCards(planId, quantity) {
            const cards = [];
            for (let i = 0; i < quantity; i++) {
                // Pequeno delay para garantir IDs √∫nicos
                setTimeout(() => {}, i);
                cards.push(generateScratchCard(planId));
            }
            return cards;
        }

        // Fun√ß√µes de interface
        function handleLogin() {
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!name || !email) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            // Validar email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Por favor, insira um e-mail v√°lido!');
                return;
            }
            
            // Criar ou carregar conta do usu√°rio
            const isExistingUser = createUserAccount(name, email);
            gameState.isLoggedIn = true;
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            initializeGame();
            
            // Mostrar mensagem de boas-vindas
            if (isExistingUser) {
                setTimeout(() => {
                    alert(`Bem-vindo de volta, ${name}! Seu saldo atual √© R$ ${gameState.balance.toFixed(2)}`);
                }, 500);
            } else {
                setTimeout(() => {
                    alert(`Bem-vindo ao RaspaCash, ${name}! Fa√ßa um dep√≥sito para come√ßar a jogar.`);
                }, 500);
            }
        }

        function initializeGame() {
            renderPlans();
            renderPromoPacks();
            renderFeed();
            updateBalance();
        }

        function renderPlans() {
            const grid = document.getElementById('plansGrid');
            grid.innerHTML = '';
            
            plans.forEach(plan => {
                const loyalty = gameState.loyaltySequences[plan.id];
                const loyaltyProgress = (loyalty.spent / (plan.cost * 10)) * 100;
                
                const planElement = document.createElement('div');
                planElement.className = `bg-gradient-to-br ${plan.color} p-1 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300`;
                
                planElement.innerHTML = `
                    <div class="bg-gray-900/90 rounded-lg p-6 h-full">
                        <h3 class="text-xl font-bold text-yellow-300 mb-2">${plan.name}</h3>
                        <p class="text-gray-300 text-sm mb-4">${plan.description}</p>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between">
                                <span class="text-cyan-300">Custo:</span>
                                <span class="text-white font-bold">R$ ${plan.cost}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-cyan-300">Pr√™mio m√°ximo:</span>
                                <span class="text-green-400 font-bold">R$ ${plan.maxPrize}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-cyan-300">Jogos:</span>
                                <span class="text-white">${loyalty.games}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-cyan-300">Investido:</span>
                                <span class="text-white">R$ ${loyalty.spent}</span>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="flex justify-between text-xs mb-1">
                                <span class="text-cyan-300">Fidelidade</span>
                                <span class="text-yellow-300">${loyaltyProgress.toFixed(1)}%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div 
                                    class="bg-gradient-to-r from-green-400 to-yellow-400 h-2 rounded-full transition-all duration-300"
                                    style="width: ${Math.min(loyaltyProgress, 100)}%"
                                ></div>
                            </div>
                            ${loyaltyProgress < 100 ? 
                                `<p class="text-xs text-gray-400 mt-1">
                                    Invista R$ ${(plan.cost * 10 - loyalty.spent).toFixed(0)} para desbloquear b√¥nus!
                                </p>` :
                                `<p class="text-xs text-green-400 mt-1">
                                    ‚úÖ B√¥nus desbloqueado! Suas chances aumentaram!
                                </p>`
                            }
                        </div>
                        
                        <button
                            onclick="buyCard(${plan.id})"
                            class="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 rounded-lg transition-all duration-300"
                        >
                            üé≤ Jogar Agora
                        </button>
                    </div>
                `;
                
                grid.appendChild(planElement);
            });
        }

        function renderPromoPacks() {
            const grid = document.getElementById('promoPacks');
            grid.innerHTML = '';
            
            promotionalPacks.forEach(pack => {
                const packElement = document.createElement('div');
                packElement.className = `bg-gradient-to-br ${pack.color} p-1 rounded-lg`;
                
                packElement.innerHTML = `
                    <div class="bg-gray-900/90 rounded-md p-4">
                        <div class="text-center mb-3">
                            <h4 class="font-bold text-yellow-300">${pack.name}</h4>
                            <p class="text-sm text-gray-300">${pack.quantity} cartelas</p>
                        </div>
                        
                        <div class="text-center mb-3">
                            <div class="text-gray-400 line-through">R$ ${pack.originalPrice}</div>
                            <div class="text-2xl font-bold text-green-400">R$ ${pack.promoPrice}</div>
                            <div class="text-sm text-orange-300">-${pack.discount}% OFF</div>
                        </div>
                        
                        <button
                            onclick="buyPromoCard(${pack.planId}, '${pack.id}')"
                            class="w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-2 rounded transition-all duration-300"
                        >
                            üõí Comprar Pacote
                        </button>
                    </div>
                `;
                
                grid.appendChild(packElement);
            });
        }

        function renderFeed() {
            const feedContent = document.getElementById('feedContent');
            feedContent.innerHTML = '';
            
            // Gerar novos ganhos din√¢micos a cada abertura
            const currentWins = generateRandomWins();
            
            currentWins.forEach((win, index) => {
                const winElement = document.createElement('div');
                winElement.className = 'bg-gray-800/50 rounded-lg p-3 border border-green-400/30';
                
                winElement.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-white font-bold">${win.name}</div>
                            <div class="text-cyan-300 text-sm">${win.plan}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-green-400 font-bold">R$ ${win.prize}</div>
                            <div class="text-gray-400 text-xs">${win.time}</div>
                        </div>
                    </div>
                `;
                
                feedContent.appendChild(winElement);
            });
        }

        function buyCard(planId) {
            const plan = plans.find(p => p.id === planId);
            
            if (gameState.balance < plan.cost) {
                alert('Saldo insuficiente! Fa√ßa um dep√≥sito para continuar.');
                showModal('depositModal');
                return;
            }
            
            // Atualizar fidelidade
            gameState.loyaltySequences[planId].spent += plan.cost;
            gameState.loyaltySequences[planId].games += 1;
            
            // Debitar saldo
            gameState.balance -= plan.cost;
            updateBalance();
            
            // Gerar cartela
            gameState.scratchCard = generateScratchCard(planId);
            gameState.selectedPlan = planId;
            
            // Mostrar tela do jogo
            document.getElementById('planSelection').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('hidden');
            document.getElementById('gameTitle').textContent = `${plan.name} - R$ ${plan.cost}`;
            
            // Inicializar jogo
            initializeScratchGame();
            saveGameState();
        }

        function buyPromoCard(planId, promoId) {
            const pack = promotionalPacks.find(p => p.id === promoId);
            
            if (gameState.balance < pack.promoPrice) {
                alert('Saldo insuficiente! Fa√ßa um dep√≥sito para continuar.');
                showModal('depositModal');
                return;
            }
            
            // Atualizar fidelidade
            gameState.loyaltySequences[planId].spent += pack.promoPrice;
            gameState.loyaltySequences[planId].games += pack.quantity;
            
            // Debitar saldo
            gameState.balance -= pack.promoPrice;
            updateBalance();
            
            // Gerar cartelas do pacote promocional
            const promoCards = generateMultipleCards(planId, pack.quantity);
            
            // Configurar estado do pacote promocional
            gameState.currentPromoPackage = {
                pack: pack,
                cards: promoCards,
                currentCard: 0,
                totalCards: pack.quantity,
                planId: planId
            };
            
            // Mostrar interface de pacote promocional
            showPromoPackageInterface();
            
            saveGameState();
        }
        
        function showPromoPackageInterface() {
            // Esconder sele√ß√£o de planos
            document.getElementById('planSelection').classList.add('hidden');
            
            // Mostrar interface do pacote promocional
            let promoInterface = document.getElementById('promoPackageInterface');
            if (!promoInterface) {
                // Criar interface do pacote promocional
                promoInterface = document.createElement('div');
                promoInterface.id = 'promoPackageInterface';
                promoInterface.className = 'max-w-4xl mx-auto';
                
                promoInterface.innerHTML = `
                    <div class="text-center mb-6">
                        <h2 class="text-3xl font-bold text-orange-300 mb-2">üî• Pacote Promocional üî•</h2>
                        <p class="text-cyan-300" id="promoPackageTitle"></p>
                        <p class="text-yellow-300" id="promoPackageProgress"></p>
                        
                        <button
                            onclick="backToPlansFromPromo()"
                            class="mt-4 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300"
                        >
                            ‚Üê Voltar aos Planos
                        </button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="promoCardsGrid">
                        <!-- Cartelas do pacote ser√£o inseridas aqui -->
                    </div>
                    
                    <div id="promoGameArea" class="hidden">
                        <!-- √Årea de jogo para cartela individual -->
                    </div>
                `;
                
                document.querySelector('main').appendChild(promoInterface);
            }
            
            promoInterface.classList.remove('hidden');
            renderPromoPackage();
        }
        
        function renderPromoPackage() {
            const pack = gameState.currentPromoPackage;
            if (!pack) return;
            
            const plan = plans.find(p => p.id === pack.planId);
            
            // Atualizar t√≠tulo e progresso
            document.getElementById('promoPackageTitle').textContent = 
                `${pack.pack.name} - ${pack.totalCards} cartelas do ${plan.name}`;
            document.getElementById('promoPackageProgress').textContent = 
                `Cartelas restantes: ${pack.totalCards - pack.currentCard}`;
            
            // Renderizar grade de cartelas
            const grid = document.getElementById('promoCardsGrid');
            grid.innerHTML = '';
            
            pack.cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                const isPlayed = index < pack.currentCard;
                const isNext = index === pack.currentCard;
                
                cardElement.className = `p-4 rounded-xl border-2 transition-all duration-300 ${
                    isPlayed ? 'bg-gray-800 border-gray-600 opacity-50' :
                    isNext ? 'bg-gradient-to-br from-yellow-900/50 to-orange-900/50 border-yellow-400 animate-pulse-gold' :
                    'bg-gradient-to-br from-purple-900/30 to-blue-900/30 border-cyan-400/30'
                }`;
                
                cardElement.innerHTML = `
                    <div class="text-center">
                        <h3 class="text-lg font-bold ${isPlayed ? 'text-gray-500' : 'text-yellow-300'} mb-2">
                            Cartela ${index + 1}
                        </h3>
                        
                        ${isPlayed ? 
                            `<div class="text-gray-500 mb-4">‚úÖ Jogada</div>
                             <div class="text-sm ${card.willWin ? 'text-green-400' : 'text-red-400'}">
                                ${card.willWin ? `Pr√™mio: R$ ${card.prize}` : 'Sem pr√™mio'}
                             </div>` :
                        isNext ?
                            `<div class="text-orange-300 mb-4 font-bold animate-pulse">üéØ Pr√≥xima</div>
                             <button onclick="playPromoCard(${index})" 
                                     class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
                                üé≤ Raspar Agora
                             </button>` :
                            `<div class="text-cyan-300 mb-4">‚è≥ Aguardando</div>
                             <button disabled class="bg-gray-600 text-gray-400 font-bold py-2 px-4 rounded-lg cursor-not-allowed">
                                Aguarde sua vez
                             </button>`
                        }
                    </div>
                `;
                
                grid.appendChild(cardElement);
            });
        }
        
        function playPromoCard(cardIndex) {
            const pack = gameState.currentPromoPackage;
            if (!pack || cardIndex !== pack.currentCard) return;
            
            // Configurar cartela atual
            gameState.scratchCard = pack.cards[cardIndex];
            gameState.selectedPlan = pack.planId;
            
            // Esconder grid de cartelas e mostrar √°rea de jogo
            document.getElementById('promoCardsGrid').classList.add('hidden');
            
            let gameArea = document.getElementById('promoGameArea');
            gameArea.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-yellow-300 mb-2">
                            Cartela ${cardIndex + 1} de ${pack.totalCards}
                        </h3>
                        <p class="text-cyan-300">Raspe para revelar os n√∫meros!</p>
                    </div>

                    <!-- Cartela de Raspadinha -->
                    <div class="bg-gradient-to-br from-gray-800 via-gray-900 to-black rounded-xl p-6 mb-6 border-2 border-yellow-400/30 shadow-2xl">
                        <div class="relative">
                            <!-- N√∫meros da Cartela -->
                            <div class="grid grid-cols-5 gap-2 w-full max-w-sm mx-auto mb-4" id="promoNumbersGrid">
                                <!-- N√∫meros ser√£o inseridos aqui -->
                            </div>

                            <!-- √Årea de Raspadinha Promocional Simplificada -->
                            <div id="promoScratchArea" class="relative w-full max-w-sm mx-auto h-48 rounded-lg cursor-pointer border-2 border-white/30 overflow-hidden">
                                <!-- Overlay de Cobertura Promocional -->
                                <div 
                                    id="promoScratchOverlay" 
                                    class="absolute inset-0 bg-gradient-to-br from-orange-300 via-orange-400 to-red-500 flex items-center justify-center transition-opacity duration-500"
                                    style="background-image: radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px); background-size: 20px 20px;"
                                >
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-white mb-2">üî• RASPE AQUI üî•</div>
                                        <div class="text-sm text-orange-100 animate-pulse">Clique 5 vezes para revelar</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Barra de Progresso -->
                            <div class="mt-4 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-cyan-300">√Årea raspada: <span id="promoScratchProgress">0.0%</span></span>
                                    <span class="text-yellow-300 font-bold animate-pulse">‚ö° Continue raspando! ‚ö°</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-3 mt-2 border border-yellow-400/30">
                                    <div 
                                        id="promoProgressBar"
                                        class="bg-gradient-to-r from-green-400 via-yellow-400 to-orange-400 h-3 rounded-full transition-all duration-300 shadow-lg"
                                        style="width: 0%"
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resultado -->
                    <div id="promoGameResult" class="hidden bg-gradient-to-br from-purple-900/80 via-blue-900/80 to-cyan-900/80 backdrop-blur-lg rounded-xl p-6 mb-6 border border-cyan-400/30 shadow-2xl">
                        <div class="text-center mb-4">
                            <h4 class="text-xl font-bold text-yellow-300 mb-2">üéâ N√∫meros Revelados!</h4>
                            <div id="promoResultContent">
                                <!-- Resultado ser√° inserido aqui -->
                            </div>
                        </div>
                    </div>

                    <!-- Bot√£o Pr√≥xima Cartela -->
                    <div id="promoNextButton" class="hidden text-center mb-6">
                        <button
                            onclick="finishPromoCard()"
                            class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-200"
                        >
                            üé≤ Pr√≥xima Cartela
                        </button>
                    </div>
                </div>
            `;
            
            gameArea.classList.remove('hidden');
            
            // Inicializar jogo da cartela promocional
            initializePromoScratchGame();
        }
        
        function initializePromoScratchGame() {
            const canvas = document.getElementById('promoScratchCanvas');
            const ctx = canvas.getContext('2d');
            
            // Renderizar n√∫meros
            renderPromoNumbers();
            
            // Inicializar cobertura (mesmo c√≥digo do jogo normal)
            const gradient = ctx.createLinearGradient(0, 0, 300, 200);
            gradient.addColorStop(0, '#C0C0C0');
            gradient.addColorStop(0.5, '#E5E5E5');
            gradient.addColorStop(1, '#A0A0A0');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 300, 200);
            
            // Adicionar textura
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            for (let i = 0; i < 50; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * 300, Math.random() * 200, Math.random() * 3, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Texto de instru√ß√£o
            ctx.fillStyle = '#666';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ü™ô RASPE AQUI ü™ô', 150, 100);
            
            // Reset estado
            gameState.scratchedArea = 0;
            gameState.isRevealed = false;
            
            // Adicionar eventos espec√≠ficos para o canvas promocional
            setupPromoScratchEvents();
        }
        
        function renderPromoNumbers() {
            const grid = document.getElementById('promoNumbersGrid');
            grid.innerHTML = '';
            
            if (!gameState.scratchCard) return;
            
            gameState.scratchCard.numbers.forEach((number, index) => {
                const numberElement = document.createElement('div');
                const isWinning = gameState.scratchCard.winningNumbers.includes(number);
                
                numberElement.className = `bg-gradient-to-br from-yellow-400 to-orange-500 text-black font-bold text-lg rounded-lg p-3 text-center shadow-lg ${
                    isWinning ? 'ring-2 ring-green-400 animate-pulse' : ''
                }`;
                
                numberElement.textContent = number;
                grid.appendChild(numberElement);
            });
        }
        
        function setupPromoSimpleScratch() {
            const scratchArea = document.getElementById('promoScratchArea');
            if (!scratchArea) return;
            
            let clickCount = 0;
            const totalClicks = 5; // Requer 5 cliques para revelar
            
            function handlePromoScratch() {
                if (gameState.isRevealed) return;
                
                clickCount++;
                const progress = (clickCount / totalClicks) * 100;
                
                // Atualizar progresso
                document.getElementById('promoScratchProgress').textContent = `${progress.toFixed(1)}%`;
                document.getElementById('promoProgressBar').style.width = `${Math.min(progress, 100)}%`;
                
                // Atualizar opacidade da cobertura
                const overlay = document.getElementById('promoScratchOverlay');
                if (overlay) {
                    overlay.style.opacity = Math.max(0, 1 - (clickCount / totalClicks));
                }
                
                // Revelar ap√≥s 5 cliques
                if (clickCount >= totalClicks) {
                    revealPromoResult();
                }
            }
            
            // Eventos de clique/toque
            scratchArea.addEventListener('click', handlePromoScratch);
            scratchArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handlePromoScratch();
            });
        }
        
        // Sistema Promocional Emocional
        function createPromoScratchSurface(ctx, width, height) {
            // Base com gradiente promocional
            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
            gradient.addColorStop(0, '#FF6B35');
            gradient.addColorStop(0.4, '#F7931E');
            gradient.addColorStop(0.8, '#FFD700');
            gradient.addColorStop(1, '#FFA500');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Efeitos de fogo
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            for (let i = 0; i < 40; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 3 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Texto promocional com sombra
            ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
            ctx.shadowBlur = 3;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            ctx.fillStyle = '#FFF';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üî• RASPE COM O DEDO üî•', width/2, height/2 - 10);
            
            ctx.fillStyle = '#FFE4B5';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('PACOTE PROMOCIONAL!', width/2, height/2 + 15);
            
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }
        
        function setupPromoEmotionalScratch() {
            const canvas = document.getElementById('promoScratchCanvas');
            if (!canvas) return;
            
            let isScratching = false;
            let lastPoint = null;
            
            function performPromoScratch(x, y) {
                const ctx = canvas.getContext('2d');
                
                ctx.globalCompositeOperation = 'destination-out';
                
                const brushSize = 25; // Brush maior para promo√ß√£o
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, brushSize);
                gradient.addColorStop(0, 'rgba(0,0,0,1)');
                gradient.addColorStop(0.6, 'rgba(0,0,0,0.9)');
                gradient.addColorStop(1, 'rgba(0,0,0,0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(x, y, brushSize, 0, 2 * Math.PI);
                ctx.fill();
                
                if (lastPoint) {
                    ctx.lineWidth = brushSize * 1.8;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = 'rgba(0,0,0,1)';
                    ctx.beginPath();
                    ctx.moveTo(lastPoint.x, lastPoint.y);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                }
                
                lastPoint = { x, y };
                
                if (Math.random() > 0.8) {
                    updatePromoScratchProgress();
                }
            }
            
            // Events id√™nticos ao sistema normal
            canvas.addEventListener('mousedown', (e) => {
                isScratching = true;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                performPromoScratch(x, y);
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (!isScratching || gameState.isRevealed) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                performPromoScratch(x, y);
            });
            
            canvas.addEventListener('mouseup', () => {
                isScratching = false;
                lastPoint = null;
                updatePromoScratchProgress();
            });
            
            canvas.addEventListener('mouseleave', () => {
                isScratching = false;
                lastPoint = null;
            });
            
            // Touch events
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isScratching = true;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
                const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
                performPromoScratch(x, y);
            }, { passive: false });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isScratching || gameState.isRevealed) return;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
                const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
                performPromoScratch(x, y);
            }, { passive: false });
            
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                isScratching = false;
                lastPoint = null;
                updatePromoScratchProgress();
            }, { passive: false });
        }
        
        function updatePromoScratchProgress() {
            if (gameState.isRevealed) return;
            
            const canvas = document.getElementById('promoScratchCanvas');
            const ctx = canvas.getContext('2d');
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparent = 0;
            
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] < 128) transparent++;
            }
            
            const area = transparent / (canvas.width * canvas.height);
            gameState.scratchedArea = area;
            
            const progress = Math.min(area * 100, 100);
            document.getElementById('promoScratchProgress').textContent = `${progress.toFixed(1)}%`;
            document.getElementById('promoProgressBar').style.width = `${progress}%`;
            
            if (area > 0.6 && !gameState.isRevealed) {
                setTimeout(() => {
                    revealPromoResult();
                }, 300);
            }
        }
        
        function revealPromoResult() {
            gameState.isRevealed = true;
            
            // Limpar canvas promocional completamente
            const canvas = document.getElementById('promoScratchCanvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Mostrar resultado
            const resultDiv = document.getElementById('promoGameResult');
            const resultContent = document.getElementById('promoResultContent');
            
            if (gameState.scratchCard.willWin) {
                gameState.prize = gameState.scratchCard.prize;
                gameState.balance += gameState.prize;
                updateBalance();
                
                resultContent.innerHTML = `
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 mx-auto max-w-sm">
                        <div class="text-yellow-300 text-2xl font-bold mb-2">üèÜ PARAB√âNS! üèÜ</div>
                        <div class="text-white text-3xl font-bold">R$ ${gameState.prize.toFixed(2)}</div>
                        <div class="text-green-100 text-sm mt-2">Pr√™mio creditado na sua conta!</div>
                    </div>
                `;
            } else {
                resultContent.innerHTML = `
                    <div class="bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg p-4 mx-auto max-w-sm">
                        <div class="text-yellow-300 text-xl font-bold mb-2">üòî Que pena!</div>
                        <div class="text-white text-lg">N√£o foi dessa vez</div>
                        <div class="text-gray-300 text-sm mt-2">Continue com as pr√≥ximas cartelas!</div>
                    </div>
                `;
            }
            
            resultDiv.classList.remove('hidden');
            document.getElementById('promoNextButton').classList.remove('hidden');
            
            saveGameState();
        }
        
        function finishPromoCard() {
            const pack = gameState.currentPromoPackage;
            
            // Avan√ßar para pr√≥xima cartela
            pack.currentCard++;
            
            // Verificar se h√° mais cartelas
            if (pack.currentCard < pack.totalCards) {
                // Voltar para grid de cartelas
                document.getElementById('promoGameArea').classList.add('hidden');
                document.getElementById('promoCardsGrid').classList.remove('hidden');
                renderPromoPackage();
            } else {
                // Todas as cartelas foram jogadas, voltar para planos
                finishPromoPackage();
            }
        }
        
        function finishPromoPackage() {
            const pack = gameState.currentPromoPackage;
            
            // Calcular estat√≠sticas finais
            let totalWins = 0;
            let totalPrize = 0;
            
            pack.cards.forEach(card => {
                if (card.willWin) {
                    totalWins++;
                    totalPrize += card.prize;
                }
            });
            
            // Mostrar resumo final
            alert(`üéâ PACOTE PROMOCIONAL CONCLU√çDO! üéâ\n\nCartelas jogadas: ${pack.totalCards}\nCartelas premiadas: ${totalWins}\nTotal de pr√™mios: R$ ${totalPrize.toFixed(2)}\n\nObrigado por jogar!`);
            
            // Limpar estado do pacote promocional
            gameState.currentPromoPackage = null;
            
            // Voltar para sele√ß√£o de planos
            backToPlansFromPromo();
        }
        
        function backToPlansFromPromo() {
            // Esconder interface de pacote promocional
            const promoInterface = document.getElementById('promoPackageInterface');
            if (promoInterface) {
                promoInterface.classList.add('hidden');
            }
            
            // Mostrar sele√ß√£o de planos
            document.getElementById('planSelection').classList.remove('hidden');
            
            // Limpar estado
            gameState.currentPromoPackage = null;
            gameState.scratchCard = null;
            gameState.selectedPlan = null;
            gameState.isRevealed = false;
            gameState.prize = 0;
            gameState.scratchedArea = 0;
            
            // Atualizar planos
            renderPlans();
            saveGameState();
        }

        function initializeScratchGame() {
            const canvas = document.getElementById('scratchCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Renderizar n√∫meros primeiro
            renderNumbers();
            
            // Limpar canvas completamente
            ctx.clearRect(0, 0, 320, 220);
            
            // Criar cobertura met√°lica real√≠stica
            createScratchSurface(ctx, 320, 220);
            
            // Reset estado
            gameState.scratchedArea = 0;
            gameState.isRevealed = false;
            gameState.isScratching = false;
            
            // Atualizar UI
            document.getElementById('scratchProgress').textContent = '0.0%';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('gameResult').classList.add('hidden');
            document.getElementById('newGameButton').classList.add('hidden');
            
            // Configurar eventos otimizados
            setupEmotionalScratch();
        }

        function renderNumbers() {
            const grid = document.getElementById('numbersGrid');
            grid.innerHTML = '';
            
            if (!gameState.scratchCard) return;
            
            gameState.scratchCard.numbers.forEach((number, index) => {
                const numberElement = document.createElement('div');
                const isWinning = gameState.scratchCard.winningNumbers.includes(number);
                
                numberElement.className = `bg-gradient-to-br from-yellow-400 to-orange-500 text-black font-bold text-lg rounded-lg p-3 text-center shadow-lg ${
                    isWinning ? 'ring-2 ring-green-400 animate-pulse' : ''
                }`;
                
                numberElement.textContent = number;
                grid.appendChild(numberElement);
            });
        }

        function setupSimpleScratch() {
            const scratchArea = document.getElementById('scratchArea');
            if (!scratchArea) return;
            
            let clickCount = 0;
            const totalClicks = 5; // Requer 5 cliques para revelar
            
            function handleScratch() {
                if (gameState.isRevealed) return;
                
                clickCount++;
                const progress = (clickCount / totalClicks) * 100;
                
                // Atualizar progresso
                document.getElementById('scratchProgress').textContent = `${progress.toFixed(1)}%`;
                document.getElementById('progressBar').style.width = `${Math.min(progress, 100)}%`;
                
                // Atualizar opacidade da cobertura
                const overlay = document.getElementById('scratchOverlay');
                if (overlay) {
                    overlay.style.opacity = Math.max(0, 1 - (clickCount / totalClicks));
                }
                
                // Revelar ap√≥s 5 cliques
                if (clickCount >= totalClicks) {
                    revealResult();
                }
            }
            
            // Eventos de clique/toque
            scratchArea.addEventListener('click', handleScratch);
            scratchArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleScratch();
            });
        }

        // Sistema Emocional de Raspadinha - Experi√™ncia Real
        function createScratchSurface(ctx, width, height) {
            // Resetar composite operation
            ctx.globalCompositeOperation = 'source-over';
            
            // Base met√°lica com gradiente
            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
            gradient.addColorStop(0, '#E8E8E8');
            gradient.addColorStop(0.3, '#D0D0D0');
            gradient.addColorStop(0.6, '#B8B8B8');
            gradient.addColorStop(1, '#A0A0A0');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Textura met√°lica com pontos brilhantes
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            for (let i = 0; i < 80; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * width, Math.random() * height, Math.random() * 2 + 0.5, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Reflexos met√°licos
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * width, Math.random() * height, Math.random() * 4 + 1, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Sombras para profundidade
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            for (let i = 0; i < 30; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * width, Math.random() * height, Math.random() * 3, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Texto de instru√ß√£o com sombra
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 2;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;
            
            ctx.fillStyle = '#666';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ü™ô RASPE COM O DEDO ü™ô', width/2, height/2 - 10);
            
            ctx.fillStyle = '#888';
            ctx.font = '12px Arial';
            ctx.fillText('Arraste para revelar os n√∫meros', width/2, height/2 + 15);
            
            // Reset shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }
        
        function setupEmotionalScratch() {
            const canvas = document.getElementById('scratchCanvas');
            if (!canvas) return;
            
            let isScratching = false;
            let lastPoint = null;
            
            // Fun√ß√£o otimizada de scratch
            function performScratch(x, y) {
                const ctx = canvas.getContext('2d');
                
                // Configurar para remover pixels
                ctx.globalCompositeOperation = 'destination-out';
                
                // Criar brush mais natural
                const brushSize = 20;
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, brushSize);
                gradient.addColorStop(0, 'rgba(0,0,0,1)');
                gradient.addColorStop(0.7, 'rgba(0,0,0,0.8)');
                gradient.addColorStop(1, 'rgba(0,0,0,0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(x, y, brushSize, 0, 2 * Math.PI);
                ctx.fill();
                
                // Conectar pontos para linha cont√≠nua
                if (lastPoint) {
                    ctx.lineWidth = brushSize * 1.5;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = 'rgba(0,0,0,1)';
                    ctx.beginPath();
                    ctx.moveTo(lastPoint.x, lastPoint.y);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                }
                
                lastPoint = { x, y };
                
                // Calcular progresso de forma otimizada (a cada 5 scratches)
                if (Math.random() > 0.8) {
                    updateScratchProgress();
                }
            }
            
            // Mouse Events
            canvas.addEventListener('mousedown', (e) => {
                isScratching = true;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                performScratch(x, y);
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (!isScratching || gameState.isRevealed) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                performScratch(x, y);
            });
            
            canvas.addEventListener('mouseup', () => {
                isScratching = false;
                lastPoint = null;
                updateScratchProgress();
            });
            
            canvas.addEventListener('mouseleave', () => {
                isScratching = false;
                lastPoint = null;
            });
            
            // Touch Events - Otimizados para mobile
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isScratching = true;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
                const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
                performScratch(x, y);
            }, { passive: false });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isScratching || gameState.isRevealed) return;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
                const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
                performScratch(x, y);
            }, { passive: false });
            
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                isScratching = false;
                lastPoint = null;
                updateScratchProgress();
            }, { passive: false });
        }
        
        function updateScratchProgress() {
            if (gameState.isRevealed) return;
            
            const canvas = document.getElementById('scratchCanvas');
            const ctx = canvas.getContext('2d');
            
            // Calcular √°rea raspada
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparent = 0;
            
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] < 128) transparent++;
            }
            
            const area = transparent / (canvas.width * canvas.height);
            gameState.scratchedArea = area;
            
            // Atualizar UI
            const progress = Math.min(area * 100, 100);
            document.getElementById('scratchProgress').textContent = `${progress.toFixed(1)}%`;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Revelar quando 60% raspado (mais emocionante)
            if (area > 0.6 && !gameState.isRevealed) {
                setTimeout(() => {
                    revealResult();
                }, 300); // Pequeno delay para build up da emo√ß√£o
            }
        }

        function revealResult() {
            gameState.isRevealed = true;
            
            // Esconder overlay de cobertura
            const overlay = document.getElementById('scratchOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            
            // Mostrar resultado
            const resultDiv = document.getElementById('gameResult');
            const resultContent = document.getElementById('resultContent');
            
            if (gameState.scratchCard.willWin) {
                gameState.prize = gameState.scratchCard.prize;
                gameState.balance += gameState.prize;
                updateBalance();
                
                resultContent.innerHTML = `
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 mx-auto max-w-sm">
                        <div class="text-yellow-300 text-2xl font-bold mb-2">üèÜ PARAB√âNS! üèÜ</div>
                        <div class="text-white text-3xl font-bold">R$ ${gameState.prize.toFixed(2)}</div>
                        <div class="text-green-100 text-sm mt-2">Pr√™mio creditado na sua conta!</div>
                    </div>
                `;
            } else {
                resultContent.innerHTML = `
                    <div class="bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg p-4 mx-auto max-w-sm">
                        <div class="text-yellow-300 text-xl font-bold mb-2">üòî Que pena!</div>
                        <div class="text-white text-lg">N√£o foi dessa vez</div>
                        <div class="text-gray-300 text-sm mt-2">Continue jogando para aumentar suas chances!</div>
                    </div>
                `;
            }
            
            resultDiv.classList.remove('hidden');
            document.getElementById('newGameButton').classList.remove('hidden');
            
            saveGameState();
        }

        function startNewGame() {
            gameState.scratchCard = null;
            gameState.selectedPlan = null;
            gameState.isRevealed = false;
            gameState.prize = 0;
            gameState.scratchedArea = 0;
            
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('planSelection').classList.remove('hidden');
            document.getElementById('gameResult').classList.add('hidden');
            document.getElementById('newGameButton').classList.add('hidden');
            
            renderPlans();
            saveGameState();
        }

        function backToPlans() {
            startNewGame();
        }

        // Fun√ß√µes de modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function confirmDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            
            if (amount < 10) {
                alert('Valor m√≠nimo para dep√≥sito √© R$ 10,00');
                return;
            }
            
            gameState.balance += amount;
            updateBalance();
            
            document.getElementById('depositAmount').value = '';
            hideModal('depositModal');
            
            alert(`Dep√≥sito de R$ ${amount.toFixed(2)} confirmado!`);
            saveGameState();
        }

        function confirmWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const name = document.getElementById('withdrawName').value;
            const pixKey = document.getElementById('pixKey').value;
            
            if (!amount || !name || !pixKey) {
                alert('Preencha todos os campos!');
                return;
            }
            
            if (amount < 20) {
                alert('Valor m√≠nimo para saque √© R$ 20,00');
                return;
            }
            
            if (amount > gameState.balance) {
                alert('Saldo insuficiente!');
                return;
            }
            
            gameState.balance -= amount;
            updateBalance();
            
            // Limpar campos
            document.getElementById('withdrawAmount').value = '';
            document.getElementById('withdrawName').value = '';
            document.getElementById('pixKey').value = '';
            
            hideModal('withdrawModal');
            
            alert(`Saque de R$ ${amount.toFixed(2)} processado! Aguarde at√© 24h √∫teis.`);
            saveGameState();
        }

        // Adicionar bot√£o de logout no header
        function addLogoutButton() {
            const header = document.querySelector('header .flex.items-center.space-x-4');
            
            // Verificar se bot√£o j√° existe
            if (!document.getElementById('logoutButton')) {
                const logoutButton = document.createElement('button');
                logoutButton.id = 'logoutButton';
                logoutButton.onclick = logout;
                logoutButton.className = 'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300';
                logoutButton.innerHTML = 'üö™ Sair';
                
                header.appendChild(logoutButton);
            }
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair? Seus dados ser√£o salvos automaticamente.')) {
                gameState.isLoggedIn = false;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                
                // Limpar campos de login
                document.getElementById('userName').value = '';
                document.getElementById('userEmail').value = '';
            }
        }

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            const hasUser = loadGameState();
            
            if (hasUser && gameState.isLoggedIn) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                initializeGame();
                addLogoutButton();
            }
        });
    </script>
</body>
</html>
