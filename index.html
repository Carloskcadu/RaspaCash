<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RaspaCash - Sistema de Raspadinha Online</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Meta Tags para SEO -->
    <meta name="description" content="RaspaCash - O melhor sistema de raspadinha online do Brasil! Ganhe prêmios de até R$ 2.000 raspando cartelas digitais.">
    <meta name="keywords" content="raspadinha, loteria, prêmios, jogos, Brasil, dinheiro, PIX">
    <meta property="og:title" content="RaspaCash - Sistema de Raspadinha Online">
    <meta property="og:description" content="Ganhe prêmios de até R$ 2.000 raspando cartelas digitais!">
    <meta property="og:url" content="https://raspacashbr.online">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎰</text></svg>">
    
    <style>
        /* Animações customizadas */
        @keyframes pulse-gold {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            }
            50% { 
                box-shadow: 0 0 40px rgba(251, 191, 36, 0.8);
            }
        }
        
        .animate-pulse-gold {
            animation: pulse-gold 2s infinite;
        }
        
        @keyframes shine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        
        .animate-shine {
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            background-size: 200% 200%;
            animation: shine 2s infinite;
        }
        
        /* Canvas para raspadinha */
        .scratch-canvas {
            cursor: crosshair;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }
        
        /* Esconder scrollbar mas manter funcionalidade */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 text-white min-h-screen min-h-[100dvh] overflow-x-hidden">
    <!-- Container Principal -->
    <div id="app">
        <!-- Tela de Login -->
        <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-gradient-to-br from-purple-900/90 via-blue-900/90 to-cyan-900/90 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-cyan-400/30 shadow-2xl">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent mb-2">
                        🎰 RaspaCash
                    </h1>
                    <p class="text-cyan-300">Entre para começar a raspar e ganhar!</p>
                    <p class="text-sm text-gray-400 mt-2">Prêmios de até R$ 2.000!</p>
                </div>
                
                <div class="space-y-4">
                    <input
                        type="text"
                        id="userName"
                        placeholder="Seu nome completo"
                        class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400"
                        required
                    />
                    <input
                        type="email"
                        id="userEmail"
                        placeholder="Seu e-mail"
                        class="w-full p-3 bg-gray-800 border border-cyan-400/30 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400"
                        required
                    />
                    <button
                        onclick="handleLogin()"
                        id="loginButton"
                        class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-600 disabled:to-gray-700 text-white font-bold py-3 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:hover:scale-100"
                    >
                        🎲 Entrar e Jogar
                    </button>
                </div>
                
                <div class="mt-6 text-center text-sm text-gray-400">
                    <p>Ao entrar, você concorda com nossos termos de uso</p>
                </div>
            </div>
        </div>

        <!-- Área Principal do Jogo -->
        <div id="gameArea" class="hidden min-h-screen p-4">
            <!-- Header -->
            <header class="flex justify-between items-center mb-6 bg-gradient-to-r from-purple-900/50 to-blue-900/50 backdrop-blur-lg rounded-xl p-4 border border-cyan-400/20">
                <div class="flex items-center space-x-3">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                        🎰 RaspaCash
                    </h1>
                    <span class="text-sm text-cyan-300" id="userWelcome"></span>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Saldo:</div>
                    <div class="text-xl font-bold text-green-400" id="userBalance">R$ 0,00</div>
                </div>
            </header>

            <!-- Seleção de Planos -->
            <div id="planSelection" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Plano Básico -->
                <div class="plan-card bg-gradient-to-br from-green-800/90 via-green-700/90 to-green-600/90 backdrop-blur-lg rounded-xl p-6 border border-green-400/30 shadow-2xl cursor-pointer transform hover:scale-105 transition-all duration-300" data-plan="basic">
                    <div class="text-center">
                        <div class="text-4xl mb-4">🌟</div>
                        <h3 class="text-2xl font-bold text-green-300 mb-2">PLANO BÁSICO</h3>
                        <div class="text-3xl font-bold text-white mb-2">R$ 3,00</div>
                        <p class="text-green-200 mb-4">Prêmios de R$ 5 a R$ 100</p>
                        <div class="bg-green-700/50 rounded-lg p-3 mb-4">
                            <div class="text-sm text-green-100">• 1 cartela</div>
                            <div class="text-sm text-green-100">• Chance de prêmio: 30%</div>
                            <div class="text-sm text-green-100">• PIX instantâneo</div>
                        </div>
                        <button class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors">
                            🎲 Escolher Plano
                        </button>
                    </div>
                </div>

                <!-- Plano Premium -->
                <div class="plan-card bg-gradient-to-br from-purple-800/90 via-purple-700/90 to-purple-600/90 backdrop-blur-lg rounded-xl p-6 border border-purple-400/30 shadow-2xl cursor-pointer transform hover:scale-105 transition-all duration-300" data-plan="premium">
                    <div class="text-center">
                        <div class="text-4xl mb-4">💎</div>
                        <h3 class="text-2xl font-bold text-purple-300 mb-2">PLANO PREMIUM</h3>
                        <div class="text-3xl font-bold text-white mb-2">R$ 7,00</div>
                        <p class="text-purple-200 mb-4">Prêmios de R$ 10 a R$ 500</p>
                        <div class="bg-purple-700/50 rounded-lg p-3 mb-4">
                            <div class="text-sm text-purple-100">• 3 cartelas</div>
                            <div class="text-sm text-purple-100">• Chance de prêmio: 45%</div>
                            <div class="text-sm text-purple-100">• PIX instantâneo</div>
                        </div>
                        <button class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 rounded-lg transition-colors">
                            🎲 Escolher Plano
                        </button>
                    </div>
                </div>

                <!-- Plano VIP -->
                <div class="plan-card bg-gradient-to-br from-red-800/90 via-red-700/90 to-red-600/90 backdrop-blur-lg rounded-xl p-6 border border-red-400/30 shadow-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 animate-pulse-gold" data-plan="vip">
                    <div class="text-center">
                        <div class="text-4xl mb-4">👑</div>
                        <h3 class="text-2xl font-bold text-red-300 mb-2">PLANO VIP</h3>
                        <div class="text-3xl font-bold text-white mb-2">R$ 15,00</div>
                        <p class="text-red-200 mb-4">Prêmios de R$ 25 a R$ 2.000</p>
                        <div class="bg-red-700/50 rounded-lg p-3 mb-4">
                            <div class="text-sm text-red-100">• 5 cartelas</div>
                            <div class="text-sm text-red-100">• Chance de prêmio: 60%</div>
                            <div class="text-sm text-red-100">• PIX instantâneo</div>
                            <div class="text-sm text-yellow-300 font-bold">• BÔNUS EXCLUSIVO!</div>
                        </div>
                        <button class="w-full bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white font-bold py-3 rounded-lg transition-colors">
                            👑 MELHOR ESCOLHA
                        </button>
                    </div>
                </div>
            </div>

            <!-- Área do Jogo de Raspadinha -->
            <div id="scratchGame" class="hidden bg-gradient-to-br from-purple-900/80 via-blue-900/80 to-cyan-900/80 backdrop-blur-lg rounded-xl p-6 mb-8 border border-cyan-400/30 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-6 text-yellow-300">🎲 Sua Cartela de Raspadinha</h3>
                
                <!-- Container da Raspadinha -->
                <div class="max-w-md mx-auto">
                    <!-- Canvas Container -->
                    <div class="relative bg-gradient-to-br from-yellow-100 to-orange-100 rounded-lg p-4 mb-4 shadow-lg">
                        <!-- Grid de Números (por trás do canvas) -->
                        <div id="numbersGrid" class="absolute inset-4 grid grid-cols-3 gap-2 z-0">
                            <!-- Os números serão gerados dinamicamente -->
                        </div>
                        
                        <!-- Canvas de Raspadinha -->
                        <canvas 
                            id="scratchCanvas" 
                            width="320" 
                            height="220"
                            class="scratch-canvas relative z-10 w-full h-full rounded-lg"
                            style="max-width: 320px; max-height: 220px;"
                        ></canvas>
                    </div>
                    
                    <!-- Barra de Progresso -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-cyan-300">Área raspada: <span id="scratchProgress">0%</span></span>
                            <span class="text-sm text-yellow-300 font-bold animate-pulse">🪙 Continue raspando! 🪙</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3 border border-yellow-400/30">
                            <div 
                                id="progressBar"
                                class="bg-gradient-to-r from-green-400 via-yellow-400 to-orange-400 h-3 rounded-full transition-all duration-300 shadow-lg"
                                style="width: 0%"
                            ></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área de Pacotes Promocionais -->
            <div id="promoGame" class="hidden bg-gradient-to-br from-orange-900/80 via-red-900/80 to-pink-900/80 backdrop-blur-lg rounded-xl p-6 mb-8 border border-orange-400/30 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-6 text-orange-300">🔥 PACOTE PROMOCIONAL 🔥</h3>
                
                <!-- Container da Raspadinha Promocional -->
                <div class="max-w-md mx-auto">
                    <!-- Canvas Container Promocional -->
                    <div class="relative bg-gradient-to-br from-yellow-100 to-orange-100 rounded-lg p-4 mb-4 shadow-lg">
                        <!-- Grid de Números Promocionais -->
                        <div id="promoNumbersGrid" class="absolute inset-4 grid grid-cols-3 gap-2 z-0">
                            <!-- Os números serão gerados dinamicamente -->
                        </div>
                        
                        <!-- Canvas de Raspadinha Promocional -->
                        <canvas 
                            id="promoScratchCanvas" 
                            width="320" 
                            height="220"
                            class="scratch-canvas relative z-10 w-full h-full rounded-lg"
                            style="max-width: 320px; max-height: 220px;"
                        ></canvas>
                    </div>
                    
                    <!-- Barra de Progresso Promocional -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-orange-300">Área raspada: <span id="promoScratchProgress">0%</span></span>
                            <span class="text-sm text-yellow-300 font-bold animate-pulse">🔥 Continue raspando! 🔥</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3 border border-orange-400/30">
                            <div 
                                id="promoProgressBar"
                                class="bg-gradient-to-r from-orange-400 via-red-400 to-pink-400 h-3 rounded-full transition-all duration-300 shadow-lg"
                                style="width: 0%"
                            ></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resultado -->
            <div id="gameResult" class="hidden bg-gradient-to-br from-purple-900/80 via-blue-900/80 to-cyan-900/80 backdrop-blur-lg rounded-xl p-6 mb-6 border border-cyan-400/30 shadow-2xl">
                <div class="text-center mb-4">
                    <h4 class="text-xl font-bold text-yellow-300 mb-2">🎉 Resultado da Cartela!</h4>
                    <div id="resultContent">
                        <!-- Resultado será inserido aqui -->
                    </div>
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="text-center space-y-4">
                <div id="nextButton" class="hidden">
                    <button
                        onclick="nextCard()"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-200"
                    >
                        🎲 Próxima Cartela
                    </button>
                </div>
                
                <div id="newGameButton" class="hidden">
                    <button
                        onclick="newGame()"
                        class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-200"
                    >
                        🎮 Novo Jogo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado do jogo
        let gameState = {
            user: null,
            balance: 0,
            currentPlan: null,
            scratchCard: null,
            cardsRemaining: 0,
            scratchCount: 0,
            scratchedArea: 0,
            isScratching: false,
            isRevealed: false,
            lastScratchPoint: null,
            totalPrize: 0
        };

        // Canvas e contexto
        let scratchCanvas = null;
        let scratchCtx = null;
        let promoScratchCanvas = null;
        let promoScratchCtx = null;

        // Sistema de Login
        function handleLogin() {
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!name || !email) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            if (!email.includes('@')) {
                alert('Por favor, digite um e-mail válido!');
                return;
            }
            
            // Simular login
            gameState.user = { name, email };
            gameState.balance = Math.random() * 50 + 10; // Entre R$ 10-60
            
            document.getElementById('userWelcome').textContent = `Olá, ${name}!`;
            document.getElementById('userBalance').textContent = `R$ ${gameState.balance.toFixed(2)}`;
            
            // Esconder tela de login e mostrar jogo
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('hidden');
            
            setupPlanSelection();
        }

        // Sistema de Seleção de Planos
        function setupPlanSelection() {
            const planCards = document.querySelectorAll('.plan-card');
            
            planCards.forEach(card => {
                card.addEventListener('click', () => {
                    const plan = card.dataset.plan;
                    selectPlan(plan);
                });
            });
        }

        function selectPlan(planType) {
            const plans = {
                basic: {
                    name: 'Básico',
                    price: 3.00,
                    cards: 1,
                    minPrize: 5,
                    maxPrize: 100,
                    winChance: 0.30
                },
                premium: {
                    name: 'Premium',
                    price: 7.00,
                    cards: 3,
                    minPrize: 10,
                    maxPrize: 500,
                    winChance: 0.45
                },
                vip: {
                    name: 'VIP',
                    price: 15.00,
                    cards: 5,
                    minPrize: 25,
                    maxPrize: 2000,
                    winChance: 0.60
                }
            };

            const selectedPlan = plans[planType];
            
            if (gameState.balance < selectedPlan.price) {
                alert('Saldo insuficiente! Adicione mais créditos para jogar.');
                return;
            }

            gameState.currentPlan = selectedPlan;
            gameState.cardsRemaining = selectedPlan.cards;
            gameState.balance -= selectedPlan.price;
            
            document.getElementById('userBalance').textContent = `R$ ${gameState.balance.toFixed(2)}`;
            document.getElementById('planSelection').classList.add('hidden');
            
            // Decidir se usar jogo normal ou promocional (30% chance de promo)
            if (Math.random() < 0.3) {
                startPromoGame();
            } else {
                startScratchGame();
            }
        }

        // Função para gerar cartela de raspadinha
        function generateScratchCard() {
            const numbers = [];
            const winningNumbers = [];
            
            // Gerar 9 números aleatórios entre 1-50
            while (numbers.length < 9) {
                const num = Math.floor(Math.random() * 50) + 1;
                if (!numbers.includes(num)) {
                    numbers.push(num);
                }
            }
            
            // Determinar se ganha baseado na chance do plano
            const wins = Math.random() < gameState.currentPlan.winChance;
            
            if (wins) {
                // Selecionar 2-4 números ganhadores
                const numWinning = Math.floor(Math.random() * 3) + 2;
                const shuffledNumbers = [...numbers].sort(() => 0.5 - Math.random());
                
                for (let i = 0; i < numWinning; i++) {
                    winningNumbers.push(shuffledNumbers[i]);
                }
                
                // Calcular prêmio
                const minPrize = gameState.currentPlan.minPrize;
                const maxPrize = gameState.currentPlan.maxPrize;
                const prize = Math.floor(Math.random() * (maxPrize - minPrize + 1)) + minPrize;
                
                gameState.totalPrize += prize;
                
                return {
                    numbers,
                    winningNumbers,
                    prize,
                    isWinner: true
                };
            }
            
            return {
                numbers,
                winningNumbers: [],
                prize: 0,
                isWinner: false
            };
        }

        // Iniciar jogo de raspadinha normal
        function startScratchGame() {
            gameState.scratchCard = generateScratchCard();
            
            document.getElementById('scratchGame').classList.remove('hidden');
            document.getElementById('promoGame').classList.add('hidden');
            
            setupScratchCanvas();
            renderNumbers();
            resetScratchState();
        }

        // Iniciar jogo promocional
        function startPromoGame() {
            gameState.scratchCard = generateScratchCard();
            
            document.getElementById('promoGame').classList.remove('hidden');
            document.getElementById('scratchGame').classList.add('hidden');
            
            setupPromoScratchCanvas();
            renderPromoNumbers();
            resetScratchState();
        }

        // Configurar canvas de raspadinha normal
        function setupScratchCanvas() {
            scratchCanvas = document.getElementById('scratchCanvas');
            scratchCtx = scratchCanvas.getContext('2d');
            
            // Criar cobertura metálica realística
            createMetallicScratchSurface(scratchCtx, 320, 220);
            
            // Adicionar eventos de scratch
            setupScratchEvents(scratchCanvas, scratchCtx);
        }

        // Configurar canvas de raspadinha promocional
        function setupPromoScratchCanvas() {
            promoScratchCanvas = document.getElementById('promoScratchCanvas');
            promoScratchCtx = promoScratchCanvas.getContext('2d');
            
            // Criar cobertura promocional especial
            createPromoScratchSurface(promoScratchCtx, 320, 220);
            
            // Adicionar eventos de scratch
            setupScratchEvents(promoScratchCanvas, promoScratchCtx);
        }

        // Criar superfície metálica de raspadinha
        function createMetallicScratchSurface(ctx, width, height) {
            // Base metálica com gradiente
            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
            gradient.addColorStop(0, '#E8E8E8');
            gradient.addColorStop(0.3, '#CACACA');
            gradient.addColorStop(0.6, '#A8A8A8');
            gradient.addColorStop(1, '#888888');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Adicionar textura metálica com pontos brilhantes
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            for (let i = 0; i < 80; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 2 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Reflexos metálicos
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 4 + 2;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Sombras para profundidade
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            for (let i = 0; i < 30; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 3 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Texto de instrução com sombra
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 2;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;
            
            ctx.fillStyle = '#555';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('🪙 RASPE COM O DEDO 🪙', width/2, height/2);
            
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // Criar superfície promocional especial
        function createPromoScratchSurface(ctx, width, height) {
            // Base com gradiente promocional
            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
            gradient.addColorStop(0, '#FF6B35');
            gradient.addColorStop(0.4, '#F7931E');
            gradient.addColorStop(0.8, '#FFD700');
            gradient.addColorStop(1, '#FFA500');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Efeitos de fogo e energia
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            for (let i = 0; i < 60; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 3 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Texto promocional com sombra
            ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
            ctx.shadowBlur = 3;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            ctx.fillStyle = '#FFF';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('🔥 RASPE COM O DEDO 🔥', width/2, height/2 - 10);
            
            ctx.fillStyle = '#FFE4B5';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('PACOTE PROMOCIONAL!', width/2, height/2 + 15);
            
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // Configurar eventos de scratch
        function setupScratchEvents(canvas, ctx) {
            // Eventos de mouse
            canvas.addEventListener('mousedown', startScratching);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('mouseup', stopScratching);
            canvas.addEventListener('mouseleave', stopScratching);
            
            // Eventos de touch
            canvas.addEventListener('touchstart', startScratching, { passive: false });
            canvas.addEventListener('touchmove', scratch, { passive: false });
            canvas.addEventListener('touchend', stopScratching, { passive: false });
            canvas.addEventListener('touchcancel', stopScratching, { passive: false });
        }

        // Sistema de Scratch Emocional Otimizado
        function startScratching(e) {
            if (gameState.isRevealed) return;
            
            gameState.isScratching = true;
            gameState.lastScratchPoint = null;
            scratch(e);
        }

        function scratch(e) {
            if (!gameState.isScratching || gameState.isRevealed) return;
            
            e.preventDefault();
            
            // Determinar qual canvas está sendo usado
            const isPromo = !document.getElementById('promoGame').classList.contains('hidden');
            const canvas = isPromo ? promoScratchCanvas : scratchCanvas;
            const ctx = isPromo ? promoScratchCtx : scratchCtx;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            let x, y;
            if (e.type.includes('touch')) {
                x = (e.touches[0].clientX - rect.left) * scaleX;
                y = (e.touches[0].clientY - rect.top) * scaleY;
            } else {
                x = (e.clientX - rect.left) * scaleX;
                y = (e.clientY - rect.top) * scaleY;
            }
            
            // Brush com gradiente suave e linhas conectadas
            ctx.globalCompositeOperation = 'destination-out';
            
            // Conectar com ponto anterior se existir
            if (gameState.lastScratchPoint) {
                ctx.lineWidth = isPromo ? 50 : 40;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                
                const lineGradient = ctx.createRadialGradient(x, y, 0, x, y, ctx.lineWidth/2);
                lineGradient.addColorStop(0, 'rgba(255,255,255,1)');
                lineGradient.addColorStop(0.6, 'rgba(255,255,255,0.8)');
                lineGradient.addColorStop(1, 'rgba(255,255,255,0.2)');
                
                ctx.strokeStyle = lineGradient;
                ctx.beginPath();
                ctx.moveTo(gameState.lastScratchPoint.x, gameState.lastScratchPoint.y);
                ctx.lineTo(x, y);
                ctx.stroke();
            }
            
            // Brush principal com gradiente
            const brushSize = isPromo ? 25 : 20;
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, brushSize);
            gradient.addColorStop(0, 'rgba(255,255,255,1)');
            gradient.addColorStop(0.6, 'rgba(255,255,255,0.8)');
            gradient.addColorStop(1, 'rgba(255,255,255,0.2)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, brushSize, 0, 2 * Math.PI);
            ctx.fill();
            
            gameState.lastScratchPoint = { x, y };
            gameState.scratchCount++;
            
            // Verificar progresso otimizado
            if (gameState.scratchCount % 5 === 0) {
                checkScratchProgress(isPromo);
            }
        }

        function stopScratching() {
            gameState.isScratching = false;
            gameState.lastScratchPoint = null;
        }

        // Verificar progresso da raspagem
        function checkScratchProgress(isPromo = false) {
            const canvas = isPromo ? promoScratchCanvas : scratchCanvas;
            const ctx = isPromo ? promoScratchCtx : scratchCtx;
            
            // Calcular porcentagem raspada
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparentPixels = 0;
            
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] < 255) {
                    transparentPixels++;
                }
            }
            
            const totalPixels = canvas.width * canvas.height;
            const percentScratched = (transparentPixels / totalPixels) * 100;
            
            gameState.scratchedArea = percentScratched;
            
            // Atualizar UI
            const progressElement = isPromo ? 'promoScratchProgress' : 'scratchProgress';
            const progressBar = isPromo ? 'promoProgressBar' : 'progressBar';
            
            document.getElementById(progressElement).textContent = `${percentScratched.toFixed(1)}%`;
            document.getElementById(progressBar).style.width = `${Math.min(percentScratched, 100)}%`;
            
            // Revelar quando atingir 60%
            if (percentScratched >= 60 && !gameState.isRevealed) {
                setTimeout(() => {
                    revealResult(isPromo);
                }, 300); // Delay emocional para build-up
            }
        }

        // Renderizar números normais
        function renderNumbers() {
            const grid = document.getElementById('numbersGrid');
            grid.innerHTML = '';
            
            if (!gameState.scratchCard) return;
            
            gameState.scratchCard.numbers.forEach((number, index) => {
                const numberElement = document.createElement('div');
                const isWinning = gameState.scratchCard.winningNumbers.includes(number);
                
                numberElement.className = `bg-gradient-to-br from-yellow-400 to-orange-500 text-black font-bold text-lg rounded-lg p-3 text-center shadow-lg ${
                    isWinning ? 'ring-2 ring-green-400 animate-pulse' : ''
                }`;
                
                numberElement.textContent = number;
                grid.appendChild(numberElement);
            });
        }

        // Renderizar números promocionais
        function renderPromoNumbers() {
            const grid = document.getElementById('promoNumbersGrid');
            grid.innerHTML = '';
            
            if (!gameState.scratchCard) return;
            
            gameState.scratchCard.numbers.forEach((number, index) => {
                const numberElement = document.createElement('div');
                const isWinning = gameState.scratchCard.winningNumbers.includes(number);
                
                numberElement.className = `bg-gradient-to-br from-orange-400 to-red-500 text-white font-bold text-lg rounded-lg p-3 text-center shadow-lg ${
                    isWinning ? 'ring-2 ring-yellow-400 animate-pulse' : ''
                }`;
                
                numberElement.textContent = number;
                grid.appendChild(numberElement);
            });
        }

        // Revelar resultado
        function revealResult(isPromo = false) {
            gameState.isRevealed = true;
            gameState.cardsRemaining--;
            
            // Remover completamente a cobertura
            const canvas = isPromo ? promoScratchCanvas : scratchCanvas;
            const ctx = isPromo ? promoScratchCtx : scratchCtx;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Mostrar resultado
            let resultHtml = '';
            
            if (gameState.scratchCard.isWinner) {
                gameState.balance += gameState.scratchCard.prize;
                document.getElementById('userBalance').textContent = `R$ ${gameState.balance.toFixed(2)}`;
                
                resultHtml = `
                    <div class="text-center">
                        <div class="text-6xl mb-4">🎉</div>
                        <div class="text-2xl font-bold text-green-400 mb-2">PARABÉNS! VOCÊ GANHOU!</div>
                        <div class="text-4xl font-bold text-yellow-300 mb-4">R$ ${gameState.scratchCard.prize.toFixed(2)}</div>
                        <div class="text-sm text-gray-300">
                            Números sorteados: ${gameState.scratchCard.winningNumbers.join(', ')}
                        </div>
                        <div class="mt-4 p-3 bg-green-900/50 rounded-lg">
                            <div class="text-green-300">💰 Prêmio adicionado ao seu saldo!</div>
                        </div>
                    </div>
                `;
            } else {
                resultHtml = `
                    <div class="text-center">
                        <div class="text-6xl mb-4">😔</div>
                        <div class="text-xl font-bold text-orange-400 mb-4">Que pena! Não foi desta vez.</div>
                        <div class="text-sm text-gray-300 mb-4">
                            Continue tentando! A sorte pode estar na próxima cartela.
                        </div>
                        <div class="mt-4 p-3 bg-blue-900/50 rounded-lg">
                            <div class="text-blue-300">🎲 Tente novamente com outro plano!</div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('resultContent').innerHTML = resultHtml;
            document.getElementById('gameResult').classList.remove('hidden');
            
            // Mostrar botões apropriados
            if (gameState.cardsRemaining > 0) {
                document.getElementById('nextButton').classList.remove('hidden');
            } else {
                document.getElementById('newGameButton').classList.remove('hidden');
            }
        }

        // Próxima cartela
        function nextCard() {
            resetScratchState();
            document.getElementById('gameResult').classList.add('hidden');
            document.getElementById('nextButton').classList.add('hidden');
            
            // Decidir se usar jogo normal ou promocional (30% chance de promo)
            if (Math.random() < 0.3) {
                startPromoGame();
            } else {
                startScratchGame();
            }
        }

        // Novo jogo
        function newGame() {
            resetGameState();
            document.getElementById('gameResult').classList.add('hidden');
            document.getElementById('newGameButton').classList.add('hidden');
            document.getElementById('scratchGame').classList.add('hidden');
            document.getElementById('promoGame').classList.add('hidden');
            document.getElementById('planSelection').classList.remove('hidden');
        }

        // Reset do estado do scratch
        function resetScratchState() {
            gameState.scratchCount = 0;
            gameState.scratchedArea = 0;
            gameState.isScratching = false;
            gameState.isRevealed = false;
            gameState.lastScratchPoint = null;
        }

        // Reset completo do jogo
        function resetGameState() {
            gameState.currentPlan = null;
            gameState.scratchCard = null;
            gameState.cardsRemaining = 0;
            gameState.totalPrize = 0;
            resetScratchState();
        }
    </script>
</body>
</html>
